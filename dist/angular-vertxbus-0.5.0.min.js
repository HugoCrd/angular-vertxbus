(function(){var a,b,c={}.hasOwnProperty;a={enabled:!0,debugEnabled:!1,prefix:"vertx-eventbus.",urlServer:""+location.protocol+"//"+location.hostname+":"+(location.port||80),urlPath:"/eventbus",reconnectEnabled:!0,sockjsStateInterval:1e4,sockjsReconnectInterval:1e4,sockjsOptions:{}},b=angular.module("knalli.angular-vertxbus",["ng"]).constant("angularVertxbusOptions",a).provider("vertxEventBus",["angularVertxbusOptions",function(b){this.enable=function(c){return null==c&&(c=a.enabled),b.enabled=c===!0,this},this.useDebug=function(c){return null==c&&(c=a.debugEnabled),b.debugEnabled=c===!0,this},this.usePrefix=function(c){null==c&&(c=a.prefix),b.prefix=c},this.useUrlServer=function(c){null==c&&(c=a.urlServer),b.urlServer=c},this.useUrlPath=function(c){null==c&&(c=a.urlPath),b.urlPath=c},this.useReconnect=function(c){null==c&&(c=a.reconnectEnabled),b.reconnectEnabled=c},this.useSockJsStateInterval=function(c){null==c&&(c=a.sockjsStateInterval),b.sockjsStateInterval=c},this.useSockJsReconnectInterval=function(c){null==c&&(c=a.sockjsReconnectInterval),b.sockjsReconnectInterval=c},this.useSockJsOptions=function(c){null==c&&(c=a.sockjsOptions),b.sockjsOptions=c},this.$get=["angularVertxbusOptions","$timeout",function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;return r=angular.extend({},a,b),g=r.enabled,f=r.debugEnabled,i=r.prefix,q=r.urlServer,p=r.urlPath,j=r.reconnectEnabled,m=r.sockjsStateInterval,l=r.sockjsReconnectInterval,k=r.sockjsOptions,n=null,d="undefined"!=typeof vertx&&null!==vertx?vertx.EventBus:void 0,g&&d?(o=""+q+p,f&&console.debug("[Vertex EventBus] Enabled: connecting '"+o+"'"),h=null,e=function(){h=new d(o,void 0,k),h.onopen=function(){f&&console.debug("[VertX EventBus] Connected"),"function"==typeof n.onopen&&n.onopen()},h.onclose=function(){f&&console.debug("[VertX EventBus] Reconnect in "+l+"ms"),"function"==typeof n.onclose&&n.onclose(),j&&c(e,l)}},e(),n={reconnect:function(){return h.close()},close:function(){return h.close()},login:function(a,b,c){return h.login(a,b,c)},send:function(a,b,c){return h.send(a,b,c)},publish:function(a,b){return h.publish(a,b)},registerHandler:function(a,b){return h.registerHandler(a,b)},unregisterHandler:function(a,b){return h.unregisterHandler(a,b)},readyState:function(){return h.readyState()},EventBus:d}):f&&console.debug("[VertX EventBus] Disabled"),n}]}]),b.service("vertxEventBusService",["$rootScope","$q","$interval","$timeout","vertxEventBus","angularVertxbusOptions",function(b,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;return v=angular.extend({},a,h),l=v.enabled,k=v.debugEnabled,m=v.prefix,s=v.urlServer,r=v.urlPath,n=v.reconnectEnabled,q=v.sockjsStateInterval,p=v.sockjsReconnectInterval,o=v.sockjsOptions,j=null!=g&&null!=(w=g.EventBus)?w.CLOSED:void 0,l&&g&&(g.onopen=function(){var a,d,e,f,g,h;u.getConnectionState(!0),b.$broadcast(""+m+"system.connected"),h=u.handlers;for(a in h)if(c.call(h,a))for(e=h[a],f=0,g=e.length;g>f;f++)d=e[f],t.registerHandler(a,d);return b.$digest()},g.onclose=function(){return u.getConnectionState(!0),b.$broadcast(""+m+"system.disconnected")}),t={registerHandler:function(a,c){return"function"==typeof c?(k&&console.debug("[VertX EventBus] Register handler for "+a),g.registerHandler(a,function(a,d){return c(a,d),b.$digest()})):void 0},unregisterHandler:function(a,b){return"function"==typeof b?(k&&console.debug("[VertX EventBus] Unregister handler for "+a),g.unregisterHandler(a,b)):void 0},send:function(a,b,c,e){var h;return null==e&&(e=1e4),c&&(h=d.defer()),g.send(a,b,function(a){return h&&h.resolve(a),"function"==typeof c?c(a):void 0}),h&&f(function(){return h.reject()},e),null!=h?h.promise:void 0},publish:function(a,b){return g.publish(a,b)}},u={handlers:{},registerHandler:function(a,b){return u.handlers[a]||(u.handlers[a]=[]),u.handlers[a].push(b),j===g.EventBus.OPEN?t.registerHandler(a,b):void 0},unregisterHandler:function(a,b){var c;return u.handlers[a]&&b(u.handlers[a])&&(c=u.handlers[a].indexOf(b),c>-1&&u.handlers[a].splice(c,1)),j===g.EventBus.OPEN?t.unregisterHandler(a,b):void 0},send:function(a,b,c,e){return null==e&&(e=1e4),j===g.EventBus.OPEN?t.send(a,b,c,e):d.reject("unknown")},publish:function(a,b){return j===g.EventBus.OPEN?t.publish(a,b):void 0},getConnectionState:function(a){return(null!=g?g.EventBus:void 0)?l?a&&(j=g.readyState()):j=g.EventBus.CLOSED:j=3,j}},e(function(){return u.getConnectionState(!0)},q),i={on:u.registerHandler,addListener:u.registerHandler,un:u.unregisterHandler,removeListener:u.unregisterHandler,send:u.send,publish:u.publish,emit:u.publish,readyState:u.getConnectionState,isEnabled:function(){return l}}}])}).call(this);